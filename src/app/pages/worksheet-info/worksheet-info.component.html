<app-header [title]="'‡πÉ‡∏ö‡∏á‡∏≤‡∏ô ' + workSheet.serial_number + ' ' + workSheet.customer_name" [modal]="true"></app-header>
<ion-content class="ion-padding">
  <app-horizontal-step-progress-bar [currentStatus]="workSheet.status"
    class="lg:hidden"></app-horizontal-step-progress-bar>
  <div class="w-full lg:h-full flex flex-col lg:flex-row gap-2">
    <div class="w-full lg:w-1/3 h-full border rounded-lg p-4">
      <div class="text-2xl">üíº ‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢</div>
      <div class="text-lg flex flex-row justify-between items-center gap-4">
        <span>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ : </span>
        <span [class]="'px-2 py-1 rounded-lg ' + selectClass(workSheet.status)">{{workSheet.status || '-'}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ : </span>
        <span>{{workSheet.seller_name || '-'}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏á‡∏≤‡∏ô : </span>
        <span>{{workSheet.serial_number || '-'}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ : </span>
        <span>{{workSheet.customer_name || '-'}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ : </span>
        <span>{{workSheet.contact || '-'}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ : </span>
        <span>{{workSheet.phone_number || '-'}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏•‡∏ô‡πå : </span>
        <span>{{workSheet.line_name || '-'}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô : </span>
        <span>{{workSheet.created_at ? formatTimeFull(workSheet.created_at) : '-'}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô : </span>
        <span>{{workSheet.date_of_acceptance ? formatTime(workSheet.date_of_acceptance) : '-'}}</span>
      </div>
      <hr class="my-2 ">
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏¢‡∏≠‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î : </span>
        <span>{{workSheet.payment.total || 0}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <div>
          <span>‡∏°‡∏±‡∏î‡∏à‡πç‡∏≤ : </span> <span class="text-red-600" *ngIf="!workSheet.payment.deposit">‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï
            {{workSheet.seller_name}}</span>
        </div>
        <span>{{workSheet.payment.deposit || 0}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ : </span>
        <span>{{workSheet.payment.total - workSheet.payment.deposit || 0}}</span>
      </div>
      <hr class="my-2 ">
      <div>
        <span>‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡∏á‡∏≤‡∏ô : </span><br>
        <img [src]="workSheet.worksheet_image || 'https://placehold.co/300x300?text=No+Image'" alt="WorkSheet Image"
          class="w-40 h-40 object-cover border rounded-lg"
          (click)="workSheet.worksheet_image ? openImage(workSheet.worksheet_image): ''">
      </div>
      <span>‡∏£‡∏π‡∏õ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á : </span><br>
      <div class="flex overflow-x-auto space-x-4 scrollbar-hide">
        <div *ngFor="let image of workSheet.reference_images" class="flex-shrink-0">
          <img [src]="image || 'https://placehold.co/300x300?text=No+Image'" alt="Reference Image"
            class="w-40 h-40 object-cover border rounded-lg" (click)="openImage(workSheet.worksheet_image)">
        </div>
      </div>
      <div *ngIf="!workSheet.reference_images">
        <img src="https://placehold.co/300x300?text=No+Image" alt="Reference Image"
          class="w-40 h-40 object-cover border rounded-lg">
      </div>
    </div>
    <div class="w-full lg:w-1/3 h-full border rounded-lg p-4">
      <div class="text-2xl">üé® ‡∏ù‡πà‡∏≤‡∏¢‡∏Å‡∏£‡∏≤‡∏ü‡∏¥‡∏Å</div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏ú‡∏π‡πâ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö : </span>
        <span>{{workSheet.design_by || '-'}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö : </span>
        <span>{{workSheet.design_date ? formatTimeFull(workSheet.design_date) : '-'}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç : </span>
        <span>{{workSheet.modify ||'-'}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö : </span>
        <span>{{workSheet.date_of_submission ? formatTimeFull(workSheet.date_of_submission) : '-'}}</span>
      </div>
      <hr class="my-2">
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏ú‡∏π‡πâ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏° : </span>
        <span>{{workSheet.confirm_by || '-'}}</span>
      </div>
      <div class="text-lg flex flex-row justify-between gap-4">
        <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏° : </span>
        <span>{{workSheet.confirm_date ? formatTimeFull(workSheet.confirm_date) : '-'}}</span>
      </div>
      <hr class="my-2">
      <div class="w-full">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">üìå ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h2>
        <div class="overflow-x-auto max-h-60">
          <table class="min-w-full bg-white border border-gray-300">
            <thead>
              <tr class="bg-gray-200 text-gray-700 uppercase text-sm leading-normal">
                <th class="py-2 px-4 text-center">‡∏•‡πç‡∏≤‡∏î‡∏±‡∏ö</th>
                <th class="py-2 px-4 text-center">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                <th class="py-2 px-4 text-center">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á</th>
                <th class="py-2 px-4 text-center">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á</th>
                <th class="py-2 px-4 text-center">‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                <th class="py-2 px-4 text-center">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</th>
                <th class="py-2 px-4 text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                <th class="py-2 px-4 text-right">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th>
              </tr>
            </thead>
            <tbody class="text-gray-600 text-sm overflow-y-auto">
              <tr class="border-b border-gray-300 hover:bg-gray-100" *ngFor="let work of workSheet.work; let i = index">
                <td class="py-2 px-4 text-center">{{i+1}}</td>
                <td class="py-2 px-4 text-center">{{work.type}}</td>
                <td class="py-2 px-4 text-center">{{work.height}}</td>
                <td class="py-2 px-4 text-center">{{work.width}}</td>
                <td class="py-2 px-4 text-center">{{work.unit_of_length}}</td>
                <td class="py-2 px-4 text-center">{{work.option}}</td>
                <td class="py-2 px-4 text-center">{{work.quantity}}</td>
                <td class="py-2 px-4 text-right">{{work.total}}</td>
              </tr>
            </tbody>
            <tfoot class="w-full text-sm ">
              <td class="py-2 px-4 text-center whitespace-nowrap">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
              <td class="py-2 px-4 text-center whitespace-nowrap">{{workSheet.work.length}}</td>
              <td class="py-2 px-4 text-center whitespace-nowrap">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
            </tfoot>
          </table>
        </div>
      </div>

      <hr class="my-2">
      <span>‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö : </span><br>
      <div class="flex overflow-x-auto space-x-4 scrollbar-hide">
        <div *ngFor="let image of workSheet.design_images" class="flex-shrink-0">
          <img [src]="image.url || 'https://placehold.co/300x300?text=No+Image'" alt="Reference Image"
            class="w-40 h-40 object-cover border rounded-lg" (click)="openImage(image.url)">
        </div>
      </div>
      <div *ngIf="!workSheet.design_images">
        <img src="https://placehold.co/300x300?text=No+Image" alt="Reference Image"
          class="w-40 h-40 object-cover border rounded-lg">
      </div>
    </div>
    <div class="w-full lg:w-1/3 h-full flex flex-col justify-between gap-2">
      <div class="border rounded-lg p-4">
        <div class="text-2xl">üì¶ ‡∏ù‡πà‡∏≤‡∏¢‡∏ú‡∏•‡∏¥‡∏ï</div>
        <div class="text-lg flex flex-row justify-between gap-4">
          <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå : </span>
          <span>{{workSheet.print_by || '-'}}</span>
        </div>
        <div class="text-lg flex flex-row justify-between gap-4">
          <span>‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏á‡∏≤‡∏ô : </span>
          <span>{{workSheet.print_by || '-'}}</span>
        </div>
        <div class="text-lg flex flex-row justify-between gap-4">
          <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå : </span>
          <span>{{workSheet.print_date ? formatTimeFull(workSheet.print_date) : '-'}}</span>
        </div>
        <hr class="my-2">
        <span>‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå : </span><br>
        <div class="flex overflow-x-auto space-x-4 scrollbar-hide">
          <div *ngFor="let image of workSheet.print_images" class="flex-shrink-0">
            <img [src]="image || 'https://placehold.co/300x300?text=No+Image'" alt="Reference Image"
              class="w-40 h-40 object-cover border rounded-lg" (click)="openImage(image)">
          </div>
        </div>
        <div *ngIf="!workSheet.print_images">
          <img src="https://placehold.co/300x300?text=No+Image" alt="Reference Image"
            class="w-40 h-40 object-cover border rounded-lg">
        </div>
      </div>
      <div class="grow border rounded-lg p-4 overflow-y-auto">
        <div class="text-2xl pb-2 flex flex-row justify-between items-center">
          <div>üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</div>
          <ion-button fill="solid" color="primary" (click)="addComment()">
            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
          </ion-button>
        </div>
        <div class="max-w-xl mx-auto">

          <!-- <h2 class="text-lg font-bold mb-4">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</h2> -->

          <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏õ‡πâ‡∏≠‡∏ô‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ -->
          <!-- <div class="bg-white p-4 rounded-lg shadow mb-4">
              <ion-item class="border border-gray-300 rounded-lg">
                <ion-textarea [(ngModel)]="newComment" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." rows="2"
                  class="w-full p-2"></ion-textarea>
              </ion-item>
              <div class="flex justify-end mt-2">
                <ion-button fill="solid" color="primary" (click)="addComment()">
                  ‡∏™‡πà‡∏á
                </ion-button>
              </div>
            </div> -->

          <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ -->
          <div *ngFor="let comment of comments" class="bg-white p-4 rounded-lg shadow mb-2">
            <div class="flex items-start">
              <!-- Avatar -->
              <img src="https://placehold.co/300x300?text=U" alt="User Avatar" class="w-10 h-10 rounded-full mr-3" />

              <div class="flex-1">
                <div class="flex justify-between items-center">
                  <h4 class="font-semibold">{{ comment.user }}</h4>
                  <span class="text-xs text-gray-500">{{ formatDate(comment.date) }}</span>
                </div>
                <p class="text-gray-700 mt-1">{{ comment.text }}</p>

                <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏≠‡∏Ñ‡∏ä‡∏±‡πà‡∏ô -->
                <div class="flex items-center mt-2 space-x-2 text-sm text-blue-500">
                  <button (click)="likeComment(comment)" class="hover:underline">üëç {{comment.likes}} ‡∏ñ‡∏π‡∏Å‡πÉ‡∏à</button>
                  <button (click)="replyComment(comment)" class="hover:underline">üí¨ {{comment.replies.length}}
                    ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</button>
                  <button (click)="deleteComment(comment)" class="text-red-500 hover:underline">üóëÔ∏è ‡∏•‡∏ö</button>
                </div>
              </div>
            </div>
            <div *ngFor="let reply of comment.replies || []" class="ml-8 mt-2 p-2 bg-gray-200 rounded-lg">
              <h5 class="font-semibold text-sm">{{ reply.user }}
                <span class="text-xs text-gray-500">{{formatDate(reply.date) }}</span>
              </h5>
              <p class="text-gray-700 text-sm">{{ reply.text }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>